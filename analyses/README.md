# Analysis Workflow

This directory contains the Quarto (`.qmd`) documents used for the analysis of the project "Depth Stratifies Viral Survival Strategies in a Deep Granitic Aquifer".

The scripts are designed to be run sequentially, as later scripts depend on the processed data (specifically `tse.rds`) generated by the first script.

## Execution Order

| Order | Script | Description |
| :--- | :--- | :--- |
| **01** | `01-tse-construction.qmd` | **Core Step.** Constructs the `TreeSummarizedExperiment` (TSE) object from raw database files. |
| **02** | `02-fig2-viral-diversity.qmd` | Generates Figure 2 (Viral diversity, rarefaction, taxonomy). |
| **03** | `03-fig3-core-virome.qmd` | Generates Figure 3 (Core virome identification and prevalence). |
| **04** | `04-fig4-abundant-rare-viral.qmd` | Generates Figure 4 (Abundant vs. rare viral biosphere). |
| **05** | `05-fig5-heatmap.qmd` | Generates Figure 5 (AMG functional landscape and metabolic potential). |
| **06** | `06-figs1-host-composition.qmd` | Supplementary Figure S1 (Host community composition). |
| **07** | `07-figs2-venn-diagram.qmd` | Supplementary Figure S2 (Venn diagrams of shared OTUs). |
| **08** | `08-figs3-lifestyle.qmd` | Supplementary Figure S3 (Detailed lifestyle stratification). |
| **09** | `09-figs4-abundant-patterns.qmd` | Supplementary Figure S4 (Patterns of abundant viruses). |
| **10** | `10-figs5-rare-patterns.qmd` | Supplementary Figure S5 (Patterns of rare viruses). |
| **11** | `11-figS6-amg-DA.qmd` | Supplementary Figure S6 (Differential abundance of AMGs). |

## Running the Analyses

You can render these files using the Quarto CLI or within RStudio/Positron.

**Example:**
```bash
# Render the first script to generate the necessary data object
quarto render 01-tse-construction.qmd

# Render subsequent analysis scripts
quarto render 02-fig2-viral-diversity.qmd
```
